<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Modern Forms fan IP control - cmb</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../../css/theme.css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  <link rel="stylesheet" href="../../css/lightbox.min.css" />
  <link href="../../css/extra.css" rel="stylesheet" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Modern Forms fan IP control";
    var mkdocs_page_input_path = "software/modernforms.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="../../js/lightbox.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
 <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
        html.glightbox-open { overflow: initial; height: 100%; }
        .gslide-title { margin-top: 0px; user-select: text; }
        .gslide-desc { color: #666; user-select: text; }
        .gslide-image img { background: white; }
        </style> <script src="../../assets/javascripts/glightbox.min.js"></script></head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> cmb</a>
        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../contact/">Contact</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Car stuff</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../car_stuff/14cux/">14CUX</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../car_stuff/14cux_rescue/">14CUX rescue kit</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../car_stuff/europa_jps/">Lotus Europa JPS</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../car_stuff/blue_star/">Mini Blue Star</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../car_stuff/mog/">Morgan Plus 8</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../car_stuff/mems_interface/">Rover MEMS diagnostics</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../car_stuff/r380_oil_pump/">Rover R380 oil pump</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../car_stuff/steering_wheel_adapters/">Steering wheel adapters</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../car_stuff/sykes_acr/">Sykes-Pickavant ACR</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Media</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../media/connections/">Connections</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../media/cosmos/">Cosmos</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../media/ferrari_vhs/">Ferrari promotional VHS</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Software/Electronics</span></p>
                <ul class="current">
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">Modern Forms fan IP control</a>
    <ul class="current">
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../nomad/">Nomad (GameTek)</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../quarantine/">Quarantine (GameTek)</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Tools</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../tools/snap-on_kra300b/">Snap-on KRA-300B</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../tools/tire_inflators/">Tire inflators</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">cmb</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" alt="Docs"></a> &raquo;</li>
          <li>Software/Electronics &raquo;</li>
      <li>Modern Forms fan IP control</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="modern-forms-fan-ip-control">Modern Forms fan IP control</h1>
<ul>
<li>Published: 2020-08-10</li>
<li>Last updated: 2022-06-11</li>
</ul>
<p>Some of the ceiling fans produced by the company <strong>Modern Forms</strong> allow remote control over IP via their built-in Wi-Fi. When first installed, the fans act as an access point and broadcast their own SSID. Users are intended to download the Modern Forms smartphone app, which is capable of configuring the fan for connecting to the user's home network (by supplying an SSID and password). The app is then capable of sending commands to control the fan speed and direction, and switch the light on or off.</p>
<p>I wanted the option of using this REST API, but I was not interested in using the Modern Forms app or otherwise connecting to their cloud services. The JSON-based API for fan control is fairly well understood, and there is now a <a href="https://www.home-assistant.io/integrations/modern_forms/">Home Assistant integration</a> that supports it. However, I wasn't able to find any information about the process of configuring the fan with the user's network SSID and password in the first place, so I figured this out through some reverse engineering work and have documented it here.</p>
<p>The first step in the process -- connecting to the fan's access point -- is covered by the owner's manual. The fan will broadcast the SSID <code>ModernFormsFan_XXXXXX</code>, with the last six characters being the last hex digits from the fan's MAC address. This access point will accept connections when supplied with the password <code>intelligence</code>. Via DHCP, it appears to serve an address in the subnet <code>10.10.10.0/24</code>, with the fan itself assuming <code>10.10.10.1</code>. The client must then make an HTTP POST request to the fan with the appropriate JSON payload. It's straightforward to do this from the command line with cURL, although note that different firmware revisions may require additional parameters. The following worked for me, with firmware <code>01.03.0017</code>:</p>
<pre><code>curl -i \
 --header &quot;Content-Type: application/json; charset=utf-8&quot; \
 --request POST \
 --data '{&quot;federatedIdentity&quot;:&quot;&quot;,&quot;owner&quot;:&quot;&quot;,&quot;deviceName&quot;:&quot;fan0&quot;,&quot;SSID&quot;:&quot;your-network-name&quot;,&quot;PASSWORD&quot;:&quot;your-network-passwd&quot;,&quot;DHCP&quot;:true,&quot;timezone&quot;:&quot;UTC-5&quot;}' \
  http://10.10.10.1/config-write-uap
</code></pre>
<p>Adjust the values of <code>deviceName</code>, <code>SSID</code>, <code>PASSWORD</code>, and <code>timezone</code> appropriately for your installation, network, and location. After receiving the request, the fan should respond with <code>HTTP/1.1 200 OK</code>, and then close the connection as it joins the new network.</p>
<p>If the above parameter set does not work on your fan, you may need to give fake email addresses as values to the <code>federatedIdentity</code> and <code>owner</code> fields. I received an email from someone with a fan running firmware <code>02.00.0026</code>, and it seems this change was required. You may want to check your firmware version by requesting <code>http://10.10.10.1/config-read</code> -- there will be a field in the returned JSON that gives the version.</p>
<p>I suspected that Modern Forms embedded code was not completely custom, but rather a commercial network stack intended for cloud-connected devices. A web search found the URL fragment <code>config-write-uap</code> in the <code>config_server.c</code> module of the <a href="https://github.com/MXCHIP/mxos">MXOS</a> stack, and this is certainly the embedded codebase used for these fans. The fans identify themselves with the hostname <code>MXCHIP</code> when they join the network.</p>
              
            </div>
          </div>
          <footer>
  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

<script>const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});</script></body>
</html>
